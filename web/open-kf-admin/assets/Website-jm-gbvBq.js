import{c as B,b as H,r,$ as P,_ as I,x as t,y as h,a7 as Q,Q as J,a8 as K,E as D,S as Y,T as Z,V as ee,W as te,a9 as ae,aa as se,ab as T,ac as _,G as k,I as re,ad as ne}from"./index-ZIyG78uh.js";import{S as le,a as ie}from"./SplitListDialog-F033KQqk.js";import{L as C}from"./LinkTable-El0AEb_C.js";import"./index-q7AxqgFf.js";import"./loading-DMU2Nz_N.js";/**
 * @license lucide-react v0.319.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=B("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]),E="Progress",b=100,[ce,ke]=H(E),[de,ue]=ce(E),R=r.forwardRef((e,a)=>{const{__scopeProgress:s,value:l,max:d,getValueLabel:i=fe,...x}=e,u=S(d)?d:b,o=A(l,u)?l:null,p=$(o)?i(o,u):void 0;return r.createElement(de,{scope:s,value:o,max:u},r.createElement(P.div,I({"aria-valuemax":u,"aria-valuemin":0,"aria-valuenow":$(o)?o:void 0,"aria-valuetext":p,role:"progressbar","data-state":V(o,u),"data-value":o??void 0,"data-max":u},x,{ref:a})))});R.propTypes={max(e,a,s){const l=e[a],d=String(l);return l&&!S(l)?new Error(pe(d,s)):null},value(e,a,s){const l=e[a],d=String(l),i=S(e.max)?e.max:b;return l!=null&&!A(l,i)?new Error(ve(d,s)):null}};const me="ProgressIndicator",xe=r.forwardRef((e,a)=>{var s;const{__scopeProgress:l,...d}=e,i=ue(me,l);return r.createElement(P.div,I({"data-state":V(i.value,i.max),"data-value":(s=i.value)!==null&&s!==void 0?s:void 0,"data-max":i.max},d,{ref:a}))});function fe(e,a){return`${Math.round(e/a*100)}%`}function V(e,a){return e==null?"indeterminate":e===a?"complete":"loading"}function $(e){return typeof e=="number"}function S(e){return $(e)&&!isNaN(e)&&e>0}function A(e,a){return $(e)&&!isNaN(e)&&e<=a&&e>=0}function pe(e,a){return`Invalid prop \`max\` of value \`${e}\` supplied to \`${a}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${b}\`.`}function ve(e,a){return`Invalid prop \`value\` of value \`${e}\` supplied to \`${a}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${b} if no \`max\` prop is set)
  - \`null\` if the progress is indeterminate.

Defaulting to \`null\`.`}const O=R,ge=xe,F=r.forwardRef(({className:e,value:a,...s},l)=>t.jsx(O,{ref:l,className:h("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...s,children:t.jsx(ge,{className:"h-full w-full flex-1 bg-[#7c3aed] transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}));F.displayName=O.displayName;const $e=Q("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),M=r.forwardRef(({className:e,variant:a,...s},l)=>t.jsx("div",{ref:l,role:"alert",className:h($e({variant:a}),e),...s}));M.displayName="Alert";const z=r.forwardRef(({className:e,...a},s)=>t.jsx("h5",{ref:s,className:h("mb-1 font-medium leading-none tracking-tight",e),...a}));z.displayName="AlertTitle";const U=r.forwardRef(({className:e,...a},s)=>t.jsx("div",{ref:s,className:h("text-sm [&_p]:leading-relaxed",e),...a}));U.displayName="AlertDescription";function he({site:e,onConfirm:a,onDialogClose:s}){const[l,d]=r.useState(!1),[i,x]=r.useState(0),[u,o]=r.useState([]),[p,f]=r.useState(),[w,g]=r.useState(!1);let m=r.useRef(null),n=r.useRef(null);const v=()=>{console.log("start fetch"),ae(e).then(W).catch(()=>f("Failed to crawl this site, please try again later."))},j=()=>{x(0),m.current&&clearInterval(m.current),m.current=setInterval(()=>{x(c=>c>=88?(clearInterval(m.current),88):c+1)},1e3)},W=()=>{n.current&&clearInterval(n.current),n.current=setInterval(()=>{se(e).then(({data:{sites_info:c}})=>{c[0].domain_status===2&&(clearInterval(n.current),clearInterval(m.current),T(e).then(({data:y})=>{o(y.url_list),x(100)}))})},5e3),j()},L=c=>{c||(s==null||s(),x(0),o([]),f(void 0),m.current&&clearInterval(m.current),n.current&&clearInterval(n.current)),d(c)},q=async c=>{o(y=>y.filter(X=>!c.includes(X.id)))},G=async()=>{g(!0);try{await _(u.map(c=>c.id)),L(!1),setTimeout(()=>a==null?void 0:a(),1e3)}catch{f("Failed to import links, please try again later.")}g(!1)},N=i<100;return t.jsxs(J,{open:l,onOpenChange:L,children:[t.jsx(K,{asChild:!0,children:t.jsx(D,{className:"text-xs font-normal h-8",onClick:v,disabled:!e.trim(),children:"Fetch more links"})}),t.jsxs(Y,{className:"sm:min-w-[48rem] sm:max-h-[80vh] flex flex-col",onPointerDownOutside:c=>c.preventDefault(),children:[t.jsx(Z,{children:t.jsx(ee,{children:N?"Crawling, please wait...":"Confirm import links"})}),p?t.jsxs(M,{children:[t.jsx(oe,{className:"h-4 w-4"}),t.jsx(z,{children:"crawl failed"}),t.jsx(U,{children:p})]}):N?t.jsxs("div",{children:[t.jsx("div",{children:`${i}%`}),t.jsx(F,{value:i})]}):t.jsx(C,{links:u,deleteLinks:q}),!N&&t.jsx(te,{children:t.jsx(D,{type:"submit",loading:w,onClick:G,children:"Confirm"})})]})]})}const Se=()=>{const[e,a]=r.useState(""),[s,l]=r.useState(!0),[d,i]=r.useState([]),[x,u]=r.useState(),[o,p]=r.useState(!1);r.useEffect(()=>{f()},[]);const f=async()=>{try{const{data:{url_list:n}}=await T();i(n)}catch(n){k.error(n.message||"Failed to get link list.")}l(!1)},w=async n=>{await ne(n),i(v=>v.filter(j=>!n.includes(j.id))),k.success("Deleted successfully")},g=async n=>{await _(n),f(),k.success("Updated successfully")},m=(n,v)=>{p(n),u(v)};return t.jsx("div",{className:"mt-[5vh]",children:t.jsxs("div",{className:"mb-10 rounded border border-zinc-200",children:[t.jsx("div",{className:"border-b border-zinc-200 px-5 py-4",children:t.jsx("h3",{className:"text-xl font-semibold leading-6 text-zinc-900 ",children:"Website"})}),t.jsx("div",{className:"p-5",children:t.jsxs("div",{children:[t.jsxs("div",{children:[t.jsx("small",{className:"text-sm font-medium leading-none",children:"Crawl"}),t.jsxs("div",{className:"flex w-full items-center space-x-2 mt-2",children:[t.jsx(re,{type:"url",placeholder:"https://www.example.com",value:e,onChange:n=>a(n.target.value)}),t.jsx(he,{site:e,onDialogClose:()=>a(""),onConfirm:f})]})]}),t.jsx("p",{className:"mt-5 text-sm text-zinc-500 dark:text-zinc-300",children:"This will crawl all the links starting with the URL (not including files on the website)."}),t.jsxs("div",{className:"pt-8",children:[t.jsxs("div",{children:[t.jsx(le,{content:"Included Links"}),t.jsx(C,{links:d,loading:s,deleteLinks:w,updateLinks:g,onSelectLink:n=>m(!0,n)})]}),t.jsx(ie,{open:o,selectedUrl:x,onOpenChange:m})]})]})})]})})};export{Se as Website};
