import{r as N,x as e,I as V,E as M,ao as H,R as f,ap as B,G as b,aq as E,ar as K}from"./index-ZIyG78uh.js";import{F as y,u as O,T as q,b as G,c as D,d as W,f as _,e as Y,g as L,P as A,h as J,i as P,j as Q,k as X,l as Z,m as $,C as U,B as ee,n as te,o as se,p as le,S as T,a as ie}from"./SplitListDialog-F033KQqk.js";import"./index-q7AxqgFf.js";import"./loading-DMU2Nz_N.js";const ae="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20fill='currentColor'%20aria-hidden='true'%20className='h-5%20w-5%20fill-current'%20%3e%3cpath%20fill-rule='evenodd'%20d='M11.47%202.47a.75.75%200%20011.06%200l4.5%204.5a.75.75%200%2001-1.06%201.06l-3.22-3.22V16.5a.75.75%200%2001-1.5%200V4.81L8.03%208.03a.75.75%200%2001-1.06-1.06l4.5-4.5zM3%2015.75a.75.75%200%2001.75.75v2.25a1.5%201.5%200%20001.5%201.5h13.5a1.5%201.5%200%20001.5-1.5V16.5a.75.75%200%20011.5%200v2.25a3%203%200%2001-3%203H5.25a3%203%200%2001-3-3V16.5a.75.75%200%2001.75-.75z'%20clip-rule='evenodd'%20%3e%3c/path%3e%3c/svg%3e",ne="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2024%2024'%20stroke-width='1.5'%20stroke='currentColor'%20aria-hidden='true'%20className='ml-1%20h-4%20w-4%20text-red-600'%3e%3cpath%20stroke-linecap='round'%20stroke-linejoin='round'%20d='M14.74%209l-.346%209m-4.788%200L9.26%209m9.968-3.21c.342.052.682.107%201.022.166m-1.022-.165L18.16%2019.673a2.25%202.25%200%2001-2.244%202.077H8.084a2.25%202.25%200%2001-2.244-2.077L4.772%205.79m14.456%200a48.108%2048.108%200%2000-3.478-.397m-12%20.562c.34-.059.68-.114%201.022-.165m0%200a48.11%2048.11%200%20013.478-.397m7.5%200v-.916c0-1.18-.91-2.164-2.09-2.201a51.964%2051.964%200%2000-3.32%200c-1.18.037-2.09%201.022-2.09%202.201v.916m7.5%200a48.667%2048.667%200%2000-7.5%200'%3e%3c/path%3e%3c/svg%3e";let R;const oe=new Uint8Array(16);function re(){if(!R&&(R=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!R))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return R(oe)}const o=[];for(let t=0;t<256;++t)o.push((t+256).toString(16).slice(1));function ce(t,l=0){return o[t[l+0]]+o[t[l+1]]+o[t[l+2]]+o[t[l+3]]+"-"+o[t[l+4]]+o[t[l+5]]+"-"+o[t[l+6]]+o[t[l+7]]+"-"+o[t[l+8]]+o[t[l+9]]+"-"+o[t[l+10]]+o[t[l+11]]+o[t[l+12]]+o[t[l+13]]+o[t[l+14]]+o[t[l+15]]}const de=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),z={randomUUID:de};function ge(t,l,g){if(z.randomUUID&&!l&&!t)return z.randomUUID();t=t||{};const r=t.random||(t.rng||re)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,l){g=g||0;for(let d=0;d<16;++d)l[g+d]=r[d];return l}return ce(r)}const ue={[y.Recorded]:{text:"Recorded",bgColor:"#787878"},[y.Parsing]:{text:"Parsing",bgColor:"#6cb2eb"},[y.Parsed]:{text:"Parsed",bgColor:"#17a2b8"},[y.Trained]:{text:"Trained",bgColor:"#38c172"}};function xe({files:t,loading:l,deleteFiles:g,onSelectFile:r}){var F,S;const[d,h]=N.useState({}),[c,u]=N.useState(!1),[p,x]=N.useState({pageIndex:0,pageSize:10}),[C,v]=N.useState([]),w=[{id:"select",header:({table:s})=>e.jsx(U,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:i=>s.toggleAllPageRowsSelected(!!i),"aria-label":"Select all"}),cell:({row:s})=>e.jsx(U,{checked:s.getIsSelected(),onCheckedChange:i=>s.toggleSelected(!!i),"aria-label":"Select row"}),enableSorting:!1,enableHiding:!1},{accessorKey:"origin_file_name",header:"File Name",cell:({row:s})=>e.jsx("div",{className:"cursor-pointer",onClick:()=>s.original.doc_status===y.Trained&&(r==null?void 0:r(s.original)),children:s.getValue("origin_file_name")})},{accessorKey:"content_length",header:()=>e.jsx("div",{className:"text-right",children:"Size"}),cell:({row:s})=>e.jsx("div",{className:"text-right font-medium",children:s.getValue("content_length")})},{accessorKey:"doc_status",header:()=>e.jsx("div",{className:"text-right",children:"Status"}),cell:({row:s})=>{const i=ue[s.getValue("doc_status")];return e.jsx("div",{className:"text-right",children:e.jsx(ee,{className:"text-white",style:{backgroundColor:i.bgColor},variant:"outline",children:i.text})})}},{id:"actions",enableHiding:!1,cell:({row:s})=>{const i=s.original;return e.jsx(M,{variant:"outline",size:"icon",onClick:()=>g([i.id]),children:e.jsx(H,{className:"h-4 w-4"})})}}],n=O({data:t,columns:w,onColumnFiltersChange:v,getCoreRowModel:te(),getPaginationRowModel:se(),getFilteredRowModel:le(),onRowSelectionChange:h,onPaginationChange:x,state:{pagination:p,columnFilters:C,rowSelection:d}});return e.jsxs("div",{className:"w-full flex-1 overflow-hidden flex flex-col",children:[e.jsx("div",{className:"flex items-center py-4 pl-1",children:e.jsx(V,{placeholder:"Filter file name...",value:((F=n.getColumn("origin_file_name"))==null?void 0:F.getFilterValue())??"",onChange:s=>{var i;return(i=n.getColumn("origin_file_name"))==null?void 0:i.setFilterValue(s.target.value)},className:"max-w-sm"})}),e.jsx("div",{className:"rounded-md border flex flex-col overflow-hidden",children:e.jsxs(q,{children:[e.jsx(G,{children:n.getHeaderGroups().map(s=>e.jsx(D,{children:s.headers.map(i=>e.jsx(W,{children:i.isPlaceholder?null:_(i.column.columnDef.header,i.getContext())},i.id))},s.id))}),e.jsx(Y,{children:(S=n.getRowModel().rows)!=null&&S.length?n.getRowModel().rows.map(s=>e.jsx(D,{"data-state":s.getIsSelected()&&"selected",children:s.getVisibleCells().map(i=>e.jsx(L,{children:_(i.column.columnDef.cell,i.getContext())},i.id))},s.id)):e.jsx(D,{children:e.jsx(L,{colSpan:w.length,className:"h-24 text-center",children:l?"loading...":"No results."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[n.getFilteredSelectedRowModel().rows.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center",children:e.jsx(M,{size:"sm",variant:"destructive",loading:c,onClick:async()=>{u(!0),await g(n.getFilteredSelectedRowModel().rows.map(s=>s.original.id)),u(!1),n.resetRowSelection()},children:"Delete"})}),e.jsxs("div",{className:"flex-1 text-sm text-muted-foreground",children:[n.getFilteredSelectedRowModel().rows.length," of"," ",n.getFilteredRowModel().rows.length," row(s) selected."]})]}):e.jsxs("div",{className:"flex-1 text-sm text-muted-foreground",children:[n.getFilteredRowModel().rows.length," total"]}),n.getFilteredRowModel().rows.length>10&&e.jsx(A,{className:"w-fit",children:e.jsxs(J,{children:[e.jsx(P,{children:e.jsx(Q,{isDisabled:!n.getCanPreviousPage(),onClick:()=>n.previousPage()})}),e.jsx(me,{totalPages:n.getPageCount(),pageIndex:p.pageIndex,setPageIndex:s=>n.setPageIndex(s)}),e.jsx(P,{children:e.jsx(X,{isDisabled:!n.getCanNextPage(),onClick:()=>n.nextPage()})})]})})]})]})}function me({totalPages:t,pageIndex:l,setPageIndex:g}){const h=(c=>{const u=Math.max(1,c-2),p=Math.min(t,c+2);let x=Array.from({length:p-u+1},(C,v)=>String(u+v));return u>1&&(x=["1","ellipsisLeft",...x]),p<t&&(x=[...x,"ellipsisRight",String(t)]),x})(l+1);return e.jsx(A,{children:h.map(c=>c==="ellipsisLeft"||c==="ellipsisRight"?e.jsx(P,{children:e.jsx(Z,{})},c):e.jsx(P,{children:e.jsx($,{isActive:l===Number(c)-1,onClick:()=>g(Number(c)-1),children:c})},c))})}const Ne=()=>{const[t,l]=f.useState(!0),[g,r]=f.useState(!1),[d,h]=f.useState([]),[c,u]=f.useState([]),[p,x]=f.useState(),[C,v]=f.useState(!1),w=f.useRef(null);N.useEffect(()=>{n()},[]);const n=async()=>{try{const{data:{file_list:a}}=await B();u(a)}catch(a){b.error(a.message||"Failed to get file list.")}l(!1)},F=async a=>{const m=a.target.files;if(!m)return;const j=Array.from(m);if(d.length+j.length>10){b.error("You can only upload up to 10 files at a time");return}j.forEach(k=>{k.uuid=ge()}),h(k=>[...k,...j])},S=a=>{h(m=>m.filter(j=>j.uuid!==a))},s=async()=>{r(!0);try{await E(d),n(),b.success("Uploaded successfully")}catch(a){b.error(a.message||"Failed to upload files")}r(!1),h([])},i=async a=>{await K(a),u(m=>m.filter(j=>!a.includes(j.id))),b.success("Deleted successfully")},I=(a,m)=>{v(a),x(m)};return e.jsx("div",{className:"mt-[5vh]",children:e.jsxs("div",{className:"mb-10 rounded border border-zinc-200",children:[e.jsx("div",{className:"border-b border-zinc-200 px-5 py-4",children:e.jsx("h3",{className:"text-xl font-semibold leading-6 text-zinc-900 ",children:"Files"})}),e.jsx("div",{className:"p-5",children:e.jsxs("div",{children:[e.jsxs("div",{className:"border border-neutral-200 p-16 cursor-pointer",onClick:()=>{var a;return(a=w.current)==null?void 0:a.click()},children:[e.jsx(V,{ref:w,onChange:F,className:"hidden",accept:"text/html,.pdf,.doc,.docx,.txt,.md,.epub,.mobi,.pptx,.xlsx,.csv",multiple:!0,type:"file",name:"file"}),e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[e.jsx("img",{width:20,src:ae,alt:"upload"}),e.jsxs("div",{className:"items-center justify-center text-center",children:[e.jsx("p",{className:"text-sm text-zinc-600 ",children:"Drag & drop files here, or click to select files"}),e.jsx("span",{className:"text-xs text-zinc-500 dark:text-zinc-300",id:"file_type_help",children:"Supported File Types: .pdf, .doc, .docx, .txt, .md, .epub, .mobi, .pptx, .xlsx, .csv"})]})]})]}),e.jsx("p",{className:"mt-2 text-center text-sm text-zinc-500 dark:text-zinc-300",id:"file_input_help",children:"If you are uploading a PDF, make sure you can select/highlight the text."}),e.jsx("div",{className:"pt-8",children:!!d.length&&e.jsxs("div",{children:[e.jsx(T,{content:"Attached Files"}),d.map(a=>e.jsx(pe,{file:a,deleteFile:S},a.uuid))]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(M,{loading:g,className:"text-xs font-normal h-8",onClick:s,disabled:!d.length,children:"Upload"})}),e.jsxs("div",{children:[e.jsx(T,{content:"uploaded Files"}),e.jsx(xe,{files:c,loading:t,deleteFiles:i,onSelectFile:a=>I(!0,a)})]})]})}),e.jsx(ie,{selectFile:p,open:C,onOpenChange:I})]})})},he=({onClick:t})=>e.jsx("button",{className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-80 underline-offset-4 hover:underline dark:text-zinc-50 h-9 px-4 py-2 ml-1 text-red-600 transition-transform duration-500 ease-in-out hover:text-red-500",type:"button",onClick:t,children:e.jsx("img",{width:16,src:ne,alt:"delete"})}),pe=({file:t,deleteFile:l})=>e.jsx("div",{className:"mt-2 max-h-[36rem] overflow-auto pr-2",children:e.jsxs("div",{className:"grid grid-cols-10 pb-2",children:[e.jsxs("div",{className:"col-span-9",children:[e.jsx("span",{className:"break-words text-sm",children:t.name})," "]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(he,{onClick:()=>l(t.uuid)})})]})});export{Ne as Files};
